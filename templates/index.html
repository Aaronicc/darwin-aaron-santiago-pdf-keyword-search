<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>PDF Keyword Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 20px;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
        }
        [data-theme="light"] {
            --bg: #ffffff;
            --text: #000000;
            --card: #f9f9f9;
            --button: #007BFF;
        }
        [data-theme="dark"] {
            --bg: #121212;
            --text: #f5f5f5;
            --card: #1f1f1f;
            --button: #1E88E5;
        }
        .container {
            max-width: 900px;
            margin: auto;
        }
        .card {
            background: var(--card);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .btn {
            background-color: var(--button);
            color: white;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }
        .hidden {
            display: none;
        }
        .line-highlight {
            background-color: yellow;
        }
        .summary {
            font-weight: bold;
        }
        .toggle-btn {
            float: right;
            margin-top: -40px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>PDF Keyword Search</h1>

    <button class="btn toggle-btn" onclick="toggleTheme()">Toggle Theme</button>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div class="card">
        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="pdf" required>
            <button type="submit" class="btn">Upload & Search</button>
        </form>
    </div>

    <div class="card">
        <form method="POST" action="{{ url_for('add_keyword') }}">
            <input type="text" name="keyword" placeholder="Add keyword" required>
            <select name="type">
                <option value="positive">Positive</option>
                <option value="negative">Negative</option>
            </select>
            <button type="submit" class="btn">Add</button>
        </form>
    </div>

    <div class="card">
        <button class="btn" onclick="toggleKeywords()">Show/Hide Keywords</button>
        <div id="keywords-section" style="display: none;">
            <h3>Positive Keywords</h3>
            <p>
                {% for kw in pos_keywords %}
                  <form id="delete-{{ kw }}" method="POST" action="{{ url_for('delete_keyword', keyword=kw) }}" style="display:inline;">
                    <span>
                      {{ kw }}
                      <button type="button" class="btn-icon" onclick="openPasswordModal('{{ kw }}')">üóëÔ∏è</button>
                    </span>
                  </form>
                  {% if not loop.last %}/ {% endif %}
                {% endfor %}
            </p>

            <h3>Negative Keywords</h3>
            <p>
                {% for kw in neg_keywords %}
                  <form id="delete-{{ kw }}" method="POST" action="{{ url_for('delete_keyword', keyword=kw) }}" style="display:inline;">
                    <span>
                      {{ kw }}
                      <button type="button" class="btn-icon" onclick="openPasswordModal('{{ kw }}')">üóëÔ∏è</button>
                    </span>
                  </form>
                  {% if not loop.last %}/ {% endif %}
                {% endfor %}
            </p>
        </div>
    </div>

    {% if summary_count %}
    <div class="card">
        <h3>Keyword Summary</h3>
        <div class="summary">
            <p>Positive:</p>
            <ul>
                {% for kw, count in summary_count['positive'].items() %}
                <li>{{ kw }}: {{ count }}</li>
                {% endfor %}
            </ul>
            <p>Negative:</p>
            <ul>
                {% for kw, count in summary_count['negative'].items() %}
                <li>{{ kw }}: {{ count }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    {% if results %}
    <div class="card">
        <h3>Search Results</h3>
        {% for result in results %}
        <div>
            <strong>Page {{ result.page }}:</strong><br>
            {% for line in result.lines %}
              <div>
                {{ line | safe }}
              </div>
            {% endfor %}
            <hr>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- Password Modal -->
<div id="passwordModal" class="hidden">
    <div class="card">
        <h3>Enter Password to Delete</h3>
        <form id="passwordForm" method="POST">
            <input type="password" name="password" id="passwordInput" required>
            <button type="submit" class="btn">Confirm</button>
            <button type="button" class="btn" onclick="closePasswordModal()">Cancel</button>
        </form>
    </div>
</div>

<script>
    let deleteKeyword = "";

    function toggleKeywords() {
        const section = document.getElementById("keywords-section");
        section.style.display = section.style.display === "none" ? "block" : "none";
    }

    function openPasswordModal(keyword) {
        deleteKeyword = keyword;
        const form = document.getElementById("passwordForm");
        form.action = "/delete/" + encodeURIComponent(keyword);
        document.getElementById("passwordModal").classList.remove("hidden");
    }

    function closePasswordModal() {
        deleteKeyword = "";
        document.getElementById("passwordModal").classList.add("hidden");
    }

    function toggleTheme() {
        const html = document.documentElement;
        const newTheme = html.getAttribute("data-theme") === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
    }
</script>
</body>
</html>
